//
// Integration tests support
//

sourceSets {
    integTest {
        scala.srcDir file('src/integTest/scala')
        resources.srcDir file('src/integTest/resources')

        compileClasspath += main.output + test.output
        runtimeClasspath += main.output + test.output
    }
}

configurations {
    integTestCompile.extendsFrom testCompile
    integTestRuntime.extendsFrom testRuntime
}


task integTest(type: Test) {
    group = 'Verification'
    description = 'Runs all integration tests'
    testClassesDir = sourceSets.integTest.output.classesDir
    classpath = sourceSets.integTest.runtimeClasspath
}

// Create jar containing integration test classes
task integTestJar(type: Jar, dependsOn: integTestClasses) {
    group = "Build"
    description = "Assembles a jar archive with integration test classes."
    baseName = "${project.name}_${scalaBinaryVersion}"
    appendix = 'itest'
    from sourceSets.integTest.output
}

// Run integration tests as part of build
check.dependsOn integTest

// Dependencies
integTest.dependsOn integTestJar
integTest.dependsOn ":sparkling-water-assembly:shadowJar"
